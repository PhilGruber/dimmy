<html>
    <head>
        <title>
            Dimmy Dashboard
        </title>
        <link rel='stylesheet' type='text/css' href='/assets/dashboard.css' />
        <script src='/assets/jquery.js'></script>
        <script>
        $(document).ready(function() {
            setInterval(function () {
                $.get('/api/status', null, function(data, status, jqXHR) {
                     for (name in data) {
                        $("#value_" + name).text(Math.round(data[name].value) + "%");
                    }
                }, "json");
            }, 1000);
        });

        function switchDevice(device, value) {
            var data = {
                device: device,
                value: value,
                duration: 1,
            };
            $.post('/api/switch', JSON.stringify(data), null, 'json');
        }
        </script>
    </head>
    <body>
        {{ range $name, $device := . }}
            {{ if not $device.Hidden }}
            <div class='device'>
                <div class='title'>
                    {{ $name }}
                </div>
                <div class='buttons'>
                    <a onClick="switchDevice('{{ $name }}', 0);">off</a>
                    <a onClick="switchDevice('{{ $name }}', parseInt($('#value_{{$name}}').text()) - 10);">-</a>
                    <span class='value' id='value_{{ $name }}'></span>
                    <a onClick="switchDevice('{{ $name }}', parseInt($('#value_{{$name}}').text()) + 10);">+</a>
                    <a onClick="switchDevice('{{ $name }}', 100);">on</a>
                </div>
            </div>
            {{ end }}
        {{ end }}
    </body>
</html>
